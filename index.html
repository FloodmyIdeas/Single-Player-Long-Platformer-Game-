<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Challenging Platformer</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #222;
    }
    canvas {
      background: #87CEEB;
      display: block;
      margin: auto;
      border: 2px solid black;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="1000" height="500"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const gravity = 0.6;
const player = {
  x: 50,
  y: 0,
  width: 30,
  height: 40,
  velX: 0,
  velY: 0,
  speed: 4,
  jumpPower: -12,
  grounded: false,
  color: "red",
  startX: 50,
  startY: 0
};

const keys = {};
const platforms = [
  { x: 0, y: 460, width: 200, height: 20 },
  { x: 300, y: 400, width: 120, height: 20 },
  { x: 500, y: 330, width: 120, height: 20 },
  { x: 700, y: 270, width: 120, height: 20 },
  { x: 900, y: 220, width: 120, height: 20 },
  { x: 1100, y: 270, width: 120, height: 20 },
  { x: 1300, y: 330, width: 120, height: 20 },
  { x: 1500, y: 400, width: 120, height: 20 },
  { x: 1700, y: 460, width: 200, height: 20 }
];

const goal = {
  x: 1750,
  y: 420,
  width: 40,
  height: 40,
  color: "lime"
};

let scrollX = 0;
let gameWon = false;

function resetPlayer() {
  player.x = player.startX;
  player.y = player.startY;
  player.velX = 0;
  player.velY = 0;
  scrollX = 0;
}

function update() {
  if (gameWon) return;

  if (keys["ArrowLeft"] || keys["a"]) player.velX = -player.speed;
  else if (keys["ArrowRight"] || keys["d"]) player.velX = player.speed;
  else player.velX *= 0.8;

  if ((keys["ArrowUp"] || keys[" "]) && player.grounded) {
    player.velY = player.jumpPower;
    player.grounded = false;
  }

  player.velY += gravity;

  player.x += player.velX;
  player.y += player.velY;

  player.grounded = false;
  platforms.forEach(p => {
    if (
      player.x < p.x + p.width &&
      player.x + player.width > p.x &&
      player.y < p.y + p.height &&
      player.y + player.height > p.y
    ) {
      if (player.velY > 0) {
        player.y = p.y - player.height;
        player.velY = 0;
        player.grounded = true;
      }
    }
  });

  // Fall off world
  if (player.y > canvas.height + 200) {
    resetPlayer();
  }

  // Scroll screen
  if (player.x > 500) scrollX = player.x - 500;

  // Win condition
  if (
    player.x + player.width > goal.x &&
    player.x < goal.x + goal.width &&
    player.y + player.height > goal.y &&
    player.y < goal.y + goal.height
  ) {
    gameWon = true;
    alert("🏁 You won! Great job!");
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.save();
  ctx.translate(-scrollX, 0);

  // Platforms
  ctx.fillStyle = "#654321";
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.width, p.height));

  // Goal
  ctx.fillStyle = goal.color;
  ctx.fillRect(goal.x, goal.y, goal.width, goal.height);

  // Player
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.width, player.height);

  ctx.restore();
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

gameLoop();
</script>
</body>
</html>
